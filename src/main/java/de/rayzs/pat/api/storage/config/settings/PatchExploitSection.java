package de.rayzs.pat.api.storage.config.settings;

import de.rayzs.pat.api.storage.storages.ConfigStorage;
import de.rayzs.pat.utils.configuration.helper.*;
import de.rayzs.pat.utils.StringUtils;
import java.util.Collections;

public class PatchExploitSection extends ConfigStorage {

    public boolean ENABLED;
    public ConfigSectionHelper<String> ALERT_MESSAGE;
    public MultipleMessagesHelper KICK_MESSAGE;

    public PatchExploitSection() {
        super("patch-exploits");
    }

    @Override
    public void load() {
        super.load();
        ENABLED = new ConfigSectionHelper<Boolean>(this, "enabled", true).getOrSet();
        ALERT_MESSAGE = new ConfigSectionHelper<>(this, "alert-message", "%prefix% &4%player% &ctried to crash/lag the server.");
        KICK_MESSAGE = new MultipleMessagesHelper(this, "kick-message", Collections.singletonList("&cFailed to read packet! Please reconnect."));
    }

    public boolean isMalicious(String text) {
        if(!ENABLED) return false;

        return text.length() > 256
                || text.contains("nbt")
                && (StringUtils.countMatches('[', text) > 15 || StringUtils.countMatches('{', text) > 25);
    }
}
